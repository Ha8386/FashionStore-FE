<app-header></app-header>

<!-- Banner / Carousel -->
<section class="position-relative carousel"
         (mouseenter)="pause()" (mouseleave)="play()"
         (touchstart)="onTouchStart($event)" (touchend)="onTouchEnd($event)">
  <div class="slides">
    <img *ngFor="let b of banners; let i = index"
         class="slide"
         [class.active]="i === index"
         [src]="b.src"
         [alt]="b.alt" />
  </div>

  <div class="dots">
    <button class="dot" *ngFor="let _ of banners; let i = index"
            [class.active]="i===index" (click)="go(i)"></button>
  </div>

  <!-- search overlay -->
  <div class="container">
    <div class="banner-search card p-3 shadow-lg">
      <form (submit)="search($event)" class="d-flex gap-2">
        <input class="form-control form-control-lg"
               [(ngModel)]="q" name="q"
               placeholder="Bạn muốn tìm sản phẩm gì ?" />
        <button class="btn btn-lg btn-primary">Tìm kiếm ngay</button>
      </form>
    </div>
  </div>
</section>

<!-- SẢN PHẨM HOT -->
<div class="container py-5">
  <h3 class="mb-4 text-center fw-bold section-title">SẢN PHẨM HOT</h3>

  <ng-container *ngIf="!loading; else loadingTpl">
    <ng-container *ngIf="rows.length; else emptyTpl">
      <div class="grid">
        <div class="card product-card" *ngFor="let p of rows">
          <div class="thumb-wrap">
            <img [src]="p.thumb || 'assets/no-image.png'"
                 class="thumb-img"
                 [alt]="p.name"
                 loading="lazy"
                 (error)="onImgErr($event)" />
          </div>
          <div class="card-body p-3">
            <div class="name clamp-2" [title]="p.name">{{ p.name }}</div>
            <div class="d-flex justify-content-between align-items-center mt-2">
              <div class="price fw-semibold" *ngIf="p.price != null">{{ p.price | number }}₫</div>
              <div class="qty text-muted">Số lượng: {{ p.quantity ?? 0 }}</div>
            </div>
            <a class="btn btn-sm btn-outline-primary w-100 mt-3"
               [routerLink]="['/product', p.id]">Xem chi tiết</a>
          </div>
        </div>
      </div>

      <!-- Phân trang -->
      <nav class="mt-4">
        <ul class="pagination pagination-sm justify-content-center mb-0">
          <li class="page-item" *ngFor="let i of pagers" [class.active]="i===page">
            <button class="page-link" (click)="goPage(i)">{{ i+1 }}</button>
          </li>
        </ul>
      </nav>
    </ng-container>
  </ng-container>

  <ng-template #loadingTpl>
    <div class="text-muted text-center">Đang tải sản phẩm…</div>
  </ng-template>
  <ng-template #emptyTpl>
    <div class="text-muted text-center">Đang cập nhật…</div>
  </ng-template>
</div>
